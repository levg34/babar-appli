<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Test</title>
		<!--
		<link rel="stylesheet" href="meuh.css">
		<script src="meuh.js"></script>
		-->
		<script>
function start() {
	_stop = false;
	(function(){
		if (!_stop) {
			notifyMe()
			setTimeout(arguments.callee, 15000);
		}
	})();
}

function stop() {
	_stop = true
}
		
function secondsToHms(d) {
	d = Number(d);
	var h = Math.floor(d / 3600);
	var m = Math.floor(d % 3600 / 60);
	var s = Math.floor(d % 3600 % 60);
	return ((h > 0 ? h + ":" + (m < 10 ? "0" : "") : "") + m + ":" + (s < 10 ? "0" : "") + s);
}

function time() {
	var remain = 0
	var _initial = new Date()
	var _final = new Date()
	_final.setHours(16)
	_final.setMinutes(30)
	_final.setSeconds(0)
	remain = (_final - _initial)/1000

	return remain
}
		
function notif() {
	var message = secondsToHms(time()) + ' remaining.'
	
	if (time()>0) {
		var options = {
		  body: message,
		  icon: "http://www.angelfire.com/art/babar/images/ft.gif"
		}
		var notification = new Notification("Not yet...",options);
	} else {
		message = "It's time to go!"
		var options = {
		  body: message,
		  icon: "https://www.yvelines.fr/wp-content/uploads/2016/Babar-Wallpapers.jpg"
		}
		var notification = new Notification("Babar",options);
	}
	
	document.getElementById('meuh').innerText = message
}

function notifyMe() {
  // Voyons si le navigateur supporte les notifications
  if (!("Notification" in window)) {
    alert("Ce navigateur ne supporte pas les notifications desktop");
  }

  // Voyons si l'utilisateur est OK pour recevoir des notifications
  else if (Notification.permission === "granted") {
    // Si c'est ok, créons une notification
	notif()
  }

  // Sinon, nous avons besoin de la permission de l'utilisateur
  // Note : Chrome n'implémente pas la propriété statique permission
  // Donc, nous devons vérifier s'il n'y a pas 'denied' à la place de 'default'
  else if (Notification.permission !== 'denied') {
    Notification.requestPermission(function (permission) {

      // Quelque soit la réponse de l'utilisateur, nous nous assurons de stocker cette information
      if(!('permission' in Notification)) {
        Notification.permission = permission;
      }

      // Si l'utilisateur est OK, on crée une notification
      if (permission === "granted") {
        notif()
      }
    });
  }

  // Comme ça, si l'utlisateur a refusé toute notification, et que vous respectez ce choix,
  // il n'y a pas besoin de l'ennuyer à nouveau.
}
		</script>
	</head>
	<body>
		<button onclick="start()">
			Start
		</button>
		<button onclick="stop()">
			Stop
		</button>
		<div id="meuh"></div>
	</body>
</html>